//
//  main.swift
//  day19
//
//  Created by Mark Johnson on 1/17/19.
//  Copyright Â© 2019 matzsoft. All rights reserved.
//

import Foundation

let input = """
                                                                                                                 |                                                                                       
               +-+ +---------+     +-------------+                                   +---------------------------|-+         +-------------------------------------------+             +---------+       
               | | |         |     |             |                                   |                           | |         |                                           |             |         |       
           +-------|---------------|-------------------------------------------------|-----+                     | |         |         +---------+                       | +-----------|-------+ +-----+ 
           |   | | |         |     |             |                                   |     |                     | |         |         |         |                       | |           |       |       | 
           |   | +-------------------------------+               +-------------------------|---------------------|-------------------------------|-----------------------|-------------|---+   |       | 
           |   |   |         |     |                             |                   |     |                     | |         |         |         |                       | |           |   |   |       | 
           |   |   |     +---------------------------------------|-------------------------|-------------+       | | +-+     +-------------------------------+           | |           |   |   |       | 
           |   |   |     |   |     |                             |                   |     |             |       | | | |               |         |           |           | |           |   |   |       | 
       +---|---|---|-----+   |     |                             |               +---|-------------------|-------|---|-----------------|---------|-----------------------|-------------|---|-+ +-+     | 
       |   |   |   |         |     |                             |               |   |     |             |       | | | |               |         |           |           | |           |   | |   |     | 
       |   |   | +-----------------|---------+                   |               |   |     |     +-------|---------|-|-----------------+         |           |           | |         +-|---|---------+ | 
       |   |   | | |         |     |         |                   |               |   |     |     |       |       | | | |                         |           |           | |         | |   | |   |   | | 
       |   |   | | |         |     |         |                   |               |   |     |     |       |       | | +-|-------------------------------------------------|-|-----------|-----|-------+ | 
       |   |   | | |         |     |         |                   |               |   |     |     |       |       | |   |                         |           |           | |         | |   | |   |     | 
       |   |   | | |     +---|-----|---------|---------------------------------------|-----------|-------|-------|-|-----------------------------------------+ +-+       | |         | |   | |   |     | 
       |   |   | | |     |   |     |         |                   |               |   |     |     |       |       | |   |                         |             | |       | |         | |   | |   |     | 
       |   |   | | |     |   |   +-----+     |                   |               |   |     |     |       |     +-|-|---|-------------------------|-----------------------|-----+     | |   | |   |     | 
       |   |   | | |     |   |   | |   |     |                   |               |   |     |     |       |     | | |   |                         |             | |       | |   |     | |   | |   |     | 
 +---------|-------|-------------|-|---|-------------+           |               |   |     |     |       |     | | |   +---------------------------------------|-|-------|-----|-+   | |   | |   +---+ | 
 |     |   |   | | |     |   |   | |   |     |       |           |               |   |     |     |       |     | | |                             |             | |       | |   | |   | |   | |       | | 
 |     |   +---|-|-|---------|-----|-----+   |       +-------------------------+ |   |     +---------------------|-|-----------------------------|-------------|---------|-|-----|---|-----|-+       | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |           |       |     | | |                             |             | |       | |   | |   | |   |         | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |           +-------|-------|-------------------------------|---------------|-+     | |   | |   | |   | +-----+ | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |                   |     | | |                             |             | | |     | |   | |   | |   | |     | | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |                   |     | | |                             |             | | |     | |   | |   | | +-|-+     | | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |                   |     | | |                             |             | | |     | |   | |   | | | |       | | | 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |         +---------------|-|-----------------------------------------------|-|-----------------------------+ +-|-+ 
 |     |       | | |     |   |   | |   | |   |                   |             | |   |         |         |     | | |                             |             | | |     | |   | |   | | | |     |   |   
 |     |       | | |     |   +---|-|---|-|---|-------+ +-+       |             | |   |         |         |     | | +-----------------+           |             | | |     | |   | |   | | | | +-----+ | S 
 |     |       | | |     |       | |   | |   |       | | |       |             | |   |         |         |     | |                   |           |             | | |     | |   | |   | | | | |   | | | | 
 |   +-----------|-------|-------|-----|-----|---------------------------------------------+   |         |     | |                   |           |             | | |     | |   | |   | | | | |   | | | | 
 |   | |       | | |     |       | |   | |   |       | | |       |             | |   |     |   |         |     | |                   |           |             | | |     | |   | |   | | | | |   | | | | 
 |   | |       | | |   +-|-------|-|-----|---|---------|-+ +-----|-------------|-----------|---|---------+     | |                   |           |             | | | +---|-------|---|-|---|-|---|-|---+ 
 |   | |       | | |   | |       | |   | |   |       | |   |     |             | |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | +-|-----+   | | |   +-|---------|-------------+   | |   |     |             | |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | | |   |   | | |     |       | |   | |   |   |   | |   |     |             | |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | | +---|---+ | +-------------------|-|-------|-----------------------------+ |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     |       |       | |   | |   |   |   | |   |     |               |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     |       | +-----|-|---------|---|---|-|---|-----|---------------|-----+   |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     |       | |     | |   | |   |   |   | |   |     |               |   | |   |   |               | |                   |           |             | | | |   | |   | |   J | | | |   | | |   
 | | |     |     | +---------+   | |   | |   |   |   | |   |     |               |   | |   |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |     | | |   | |   | |   |   |   | |   |     |               |   | |   |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |     +---------|---|-|-----------|-|---|-----|-------------------|-----|---|---------+     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |       | |   | |   | |   |   |   | |   |     |               |   | |   |   |         |     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |       | |   | |   | |   |   |   | |   |     |       +-------|---|-|-----+ |         |     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |       | |   | |   | |   |   |   | |   |     |       |       |   | |   | | |         |     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   
 | | |     |     | |       +-|---|-------|---|---|---|-----|-----+ +-----|-----------|-|---|-------------|-----|-+ +-----------------------------|-------------|-----+   | |   | |   | | | | |   | | |   
 | | |     |     | |         |   | |   | |   |   |   | |   |       |     |       |   | |   | | |         |     |   |                 |           |             | | |     | |   | |   | | | | |   | | |   
 | | |     +---------------------|-----|-|-------------|-----------|-------------|---|-|---|-+ |         |     |   |                 |           |             | | |   +-------|---+ | | | | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |           |             | | |   | | |   | | | | | | | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |           |             | | |   | | |   | | | | | | | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |           |             | | |   | | |   | | | | | | | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |     +-------------------|-----------|---|-|-|-----+ | |   | | |   
 | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |     |     |             | | |   | | |   | | | | |   | |   | | |   
 | | |           | +---------|-----|---|-|---|---|-----+   |       |     |       |   | +---|-------------|---------------------------|----E|-+   |             | | |   | | |   | | | | |   | |   | +-+   
 | | |           |           |   | |   | |   |   |   |     |       |     |       |   |     |   |         |     |   |                 |     | |   |             | | |   | | |   | | | | |   | |   |       
 | | |           |     +---+ |   | |   | |   |   |   |   +---------|-----|-----------------|---|---------|---------------------------+     | |   |             | | |   | | |   | | | | |   | |   |       
 | | |           |     |   | |   | |   | |   |   |   |   | |       |     |       |   |     |   |         |     |   |                       | |   |             | | |   | | |   | | | | |   | |   |       
 | | |           |     |   | |   | |   | |   | +---------|---------------|---------------------|---------|-----+   |                       | |   |             | | |   | | |   | | | | |   | |   |       
 | | |           |     |   | |   | |   | |   | | |   |   | |       |     |       |   |     |   |         |         |                       | |   |             | | |   | | |   | | | | |   | |   |       
 | +-------------|-----|---|-----|-----|-----|-|-----|-----|-------|-----|-----------|---------|-------------------|-----------------------|-|-----------------+ | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   |   | |       |     |       |   |     |   |         |         |                       | |   |               | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   | +-|---------------|-----------|-----|---|-------------------------------------------|-----|-+             | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | |   | | | | |   | |   |       
 |   |           |     |   | |   | |   | |   | | |   T | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | |   | | | | |   | |   |       
 |   |         +-|-----|-----|---|-|---|---------|-----|-----------|-----|-------|---|---------|-------------------------------------------|-|---|-|-------------|-------|---+ | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       
 |   | +-------|-|-+   |   | |   | |   | |   | | |   | | | |       | +---|-------|---|-----|---|-------------------|-----------------------|-------------------------------|-|-|-|---|---------------+   
 |   | |       | | |   |   | |   | |   | |   | | |   | | | |       | |   |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |   |   
 |   | |       | | |   |   | |   | |   | |   | | |   | +-------------|---------------|---------+         |         |                       | |   | |             | |   | | | | | | | | |   | |   |   |   
 |   | |       | | |   |   | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   | |             | |   | | | | | | | | |   | |   |   |   
 |   | |       | | |   | +-|-|-----------|-----|---------|-|-------|-|---|-----------------|-------------|---------|-----------------------|-----|-|---------------|-----|-+ | | | | | +---+ |   |   |   
 |   | |       | | |   | | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   | |             | |   | |   | | | | |       |   |   |   
 |   | |       | | |   +-----|---|-------------------|---|---------|-----|-----------|-----------------------------|-------------------------|-----+             | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   
 |   | |       | | |     | | +-----|---|-|-----------------|-------|-|---------------------------------------------+                       | |   |               | |   | |   | | | | |       |   |   +-+ 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |       |   |     |             |                                 | |   |               | |   | |   | | | | |       |   |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |       +---------|-------------|-------------+                   | +---|---------------|-|---------+ | +-------------+ |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |             |             |                   |     |               | |   | |     |   | |       | | |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |             +-------------|---------+         |     |     +-----+   | |   | |     |   | |       | | |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |         |         |     |     |     |   | |   | |     |   | |       | | |     | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   +-----|---------|-----------|-----|---------|-------------|---------------+ | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   |     |         |     |     |     |   | |   | |     |   | |       | | |   | | 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   |     |         |     |     | +-------|-------|-----------------------|-----+ 
 |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   |     |         |     |     | |   |   | |   | |     |   | |       | | |   |   
 |   | |       | | |     | |   +---+   | |   | | |   |   +-----------|---|---------------------------------------------|---|---------------|-----------|-|---|---|-----|-|-----|---|-----------|-----|-+ 
 |   | |       | | |     | |   | |     | |   | | |   |     |       | |   |           |     |                           |   |     |         |     |     | |   |   | |   | |     |   | |       | | |   | | 
 |   | |       | | |     | | +-----+   | |   | | |   |     +-------|-----|-----------|---------+                       |   |     |         | +-------------+ |   | |   | |     |   | |       | | |   +-+ 
 |   | |       | | |     | | | | | |   | |   | | |   |             | |   |           |     |   |                       |   |     |         | |   |     | | | |   | |   | |     |   | |       | | |       
 |   | |     +---|-------+ | | | | |   | |   | | |   | +-------------|---|-----------|-----|---|-----------------------|---|-----|---------|-|---|-----+ | | |   | +-----------------------+ | | |   +-+ 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       |   |     |         | |   |       | | |   |     | |     |   | |     | | | |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | +-|-----|---------|-|---|-------|-|-----------|-|---------|-|-----|---+ |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | |     |         | |   |       | | |   |     | |     |   | |     | |   |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | +---|---+     | |   |       | | |   |     | |     |   | |     | |   |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | |   |   |     | |   |       | | |   |     | |     |   | |     | |   |   | | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | |   |   |     | |   |       | | |   |     | |     |   | |     | |   | +-+ | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | |   |   |     | |   |       | | |   |     | |     |   | |     | |   | |   | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |               +-----------|-----|---|---+ +-|---|-----+ | | |   |     | |     |   | +-----+ |   | |   | 
 |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |               |       | | | |   |   |   |   |   |     | | | |   |     | |     |   |         |   | |   | 
 |   | |     +---------------|-|-|-|-----|---|-|-|-------------------+   |           |     +-------------------|---------|---------------|---|---|-----------|---------+ |     |   |         |   | |   | 
 |   | |       | | |       | | | | |   | |   | | |   | |           |     |           |         |               |       | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |   | 
 |   | |       | | |       | | | | |   | |   | | |   | |           |     |           |         |               |       | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |   | 
 |   | |       | | |       | | | | |   | |   | | |   | |           |     |           |         |               |       | | | |   |   |   |   |   |     | M | |   |       |     |   |         |   | |   | 
 |   | |       | | |     +---|-|---|---|---------|-----+           |     |           |         |               |     +-|---|-|---|-----------|---|-----|-|---|-----------------------------------|-----+ 
 |   | |       | | |     | | | | | |   | |   | | |   |             |     |           |         |               |     | | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |     
 |   | |       | | |     | | | | | |   | |   | | |   |             |     |           |         |               |     | | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |     
 |   | |       | | |     | | | | | |   | |   | | |   |             |     |           |         |               |     | | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |     
 +-------------|---------|---|---|-----------|-|-----|---------+   |     |         +-|-+ +-----|---------------|-----|-------|---|---|---|---------+   | | | |   |       |     |   |         |   | |     
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |               |     | | | | |   |   |   |   |   | |   | | | |   |       |     |   |         |   | |     
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       +---------------|-|---|---------------------|-------|-+   |       |     |   |         |   | |     
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | |     |       |     |   |         |   | |     
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | |     |       |     |   |   +-----+ +-------+ 
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | |     |       |     |   |   |       | | |   | 
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | +-----|-+     |     |   |   |       | | |   | 
     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |       | |     |     |   |   |       | | |   | 
     | |       | | |     | | | | | | +---------|-+   | +-------|---------|-------------|-|-------------|-------------------------|---|---|---|---|-------|-----+ +-+     |   +---------------+ | | |   | 
     | |       | | |     | | | | | | | | |   | |     | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |   |   |     | | | |   | 
     | |       | | |     | | | | +---|G--+   | |     | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |   |   |     | | | |   | 
     | |       | | |     | | | |   | | |     | |     | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |   |   |     | | | |   | 
     | |       | | |     | | | |   | | |     | |   +-|-|-----------|---------------|-----|-------------|-------|-----|-|-|-|-----|-----------|-----------|---------------|---|-|---+   |     | | | |   | 
     | |       | | |     | | | |   | | |     | |   | | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |       |     | | | |   | 
     | |       | | | +---|-|-|-+   | | |     | |   | | |       |   |     |         | | | +-----|-------|-------+     | +-----|---|-----------|-----|-----------|-------------|-|---------+   | | | |   | 
     | |       | | | |   | | |     | | |     | |   | | |       |   |     |         | | |       |       |             |   | | |   |   |   |   |   | |   | |     |         |   | |       | |   | | | |   | 
     | |       | | | |   | | |     | | +-------|-------|---------------------------|-------------------|-------------------|-----|---------------------|-|-----|-------------|-|-------------|---|-|-+ | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             |   | | |   |   |   |   |   | |   | |     |         |   | |       | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             |   | | | +-----------------|-+   | |     |         |   | |       | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             |   | | | | |   |   |   |   |     | |     |         |   | |       | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             | +-------|-----|---+   |   |     | +-----|---------|---|-------+ | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             | | | | | | |   |       |   |     |       |         |   | |     | | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |     +-------------+       |       |             | | | | | | |   |       |   |     |       |         |   | |     | | |   | | | | | | 
     | |       | | | |   | | |     | |       | |   | | |       |   |               | |         |       |             | | | | | | |   |       |   |     |       |         |   | |     | | |   | | | | | | 
     | |       | | | |   | +----------------P--|-+ | | |       |   |               | |         |       |             | | | | | | |   | +---------------|-------+         |   | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | |         |       |             | | | | | | |   | |     |   |     |                 |   | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | | +-------|---------------------|-|-----|---|-----|-----|---------|-------------------+ | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | | |       |       |             | | | | | | |   | |     |   |     |                 | | | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | | |       |       |             | +---|-|---|---|-|-----|-----------------+         | | | |     | | |   | | | | | | 
     | |       | | | |   |   |     | |       | | | | | |       |   |               | | |       |       |             |   | | | | |   | |     |   |     |       |         | | | |     | | |   | | | | | | 
     | |   +---+ | | |   |   |     | |       | | | | | |       |   |             +-|-|-|---------------|-------------------+ | | |   | |     |   | +---|-------+         | | | |     | | |   | | | | | | 
     | |   |     | | |   |   |     | |       | | | | | |       |   |             | | | |       |       |             |   |   | | |   | |     |   | |   |                 | | | |     | | |   | | | | | | 
     | |   |     | | |   |   |   +---|---------|-|-|-|---------|---|-----------------|-----------------------------------------|-----|-|-----|---|-|-------+ +-----+ +---|-----|-+ +-|-|---------|---|-+ 
     | |   |     | | |   |   |   | | |       | | | | | |       |   |             | | | |       |       |             |   |   | | |   | |     |   | |   |   | |     | |   | | | | | | | | |   | | | | |   
     | |   |     | | |   |   |   | | |       | | | | | |       |   |             | | | |       |       |             |   +-----|-|-----|-----|---|-|---------|-----+ |   | | | | | | | | |   | | | | |   
     | |   |     | | |   |   |   | | |       | | | | | |       |   |             | | | |       |       |             |       | | |   | |     |   | |   |   | |       |   | | | | | | | | |   | | | | |   
     | |   |     +-|---------|-----|---------|---|-|---|-------|-----+           | | | |       |       |             | +---+ | | |   | |     +---|-|---------------------|---|-----|-|-|-|-----+ | | |   
     | |   |       | |   |   |   | | |       | | | | | |       |   | |           | | | |       |       |             | |   | | | |   | |         | |   |   | |       |   | | | | | | | | |   |   | | |   
     | |   |       | |   |   |   | | |       | | | | | |       |   | |           | | +-------------------------------|-|-+ | | | |   | |         | |   |   +-|-+     |   | | | | | | | | |   |   | | |   
     | |   |       | |   |   |   | | |       | | | | | |       |   | |           | |   |       |       |             | | | | | | |   | |         | |   |     | |     |   | | | | | | | | |   |   | | |   
   +---------------|-|---|-------|-|---------|---|-|-|-|-------------|-----------|-----|-------|---------------------|-|---|-|---------|---------|-|---|-----|-----------|-----|---|---|-|-------------+ 
   | | |   |       | |   |   |   | | |       | | | | | |       |   | |           | |   |       |       |             | | | | | | |   | |         | |   |     | |     |   | | | | | | | | |   |   | | | | 
   | | |   | +-+   | |   |   +---|-|-+       | | | | | +---------------------------|---|-------|-------|----------K----|---|---|-----+ |         +-------------+     |   +---+ | | +-+ | |   |   | | | | 
   | | |   | | |   | |   |       | |         | | | | |         |   | |           | |   |       |       |             | | | | | | |     |           |   |     |       |     |   | |     | |   |   | | | | 
   | | |   | | |   +-|-----------|-----------|-|-----------------------------------|-----------|-----------------------|-|-|-|---------|---------------|-------------------|---|-------|-+   |   +---|-+ 
   | | |   | | |     |   |       | |         | | | | |         |   | |           | |   |       |       |             | | | | | | |     |           |   |     |       |     |   | |     |     |     | |   
   | | |   | | |     |   |       | |         +-|---|-|---------------------------|-|-----------|-------------------------|---+ | |     |           |   |     +-+   +-+     |   | |     |     |   +-----+ 
   | | |   | | |     |   |       | |           | | | |         |   | |           | |   |       |       |             | | | |   | |     |           |   |       |   |       |   | |     |     |   | | | | 
   | | |   | | |     |   |       | +-----------|-----|---------|---|-------------|-----|-------|---------------------|-|-|-+   | |     |           |   |       |   |       |   | |     |     |   | | | | 
   | | |   | | |     |   |       |             | | | |         |   | |           | |   |       |       |             | | |     | |     |           |   |       |   |       |   | |     |     |   | | | | 
   +-|-+   | | |     |   |       |             | | | |         |   | |           | |   |       |       | +-----+   +-+ | +---+ | | +---------------------------------------|-----------------|-+ | | | | 
     |     | | |     |   |       |             | | | |         |   | |           | |   |       |       | |     |   |   |     | | | |   |           |   |       |   |       |   | |     |     | | | | | | 
     |     | | |     |   |       |             | | | |         |   | |           | |   |       | +-----|-|---------|---|-----|-|-|-----|---------+ |   |       |   | +-----|--V--|---+ |     | | | | | | 
     |     | | |     |   |       |             | | | |         |   | |           | |   |       | |     | |     |   |   |     | | | |   |         | |   |       |   | |     |   | |   | |     | | | | | | 
 +---|-+   | +-|-----|-------------------------|-----|-------------|-------------|-----|-----+ | |     | +-----|---|-------------------|---------|---+ |       |   | |     |   | | +-+ | +-----+ | | | | 
 |   | |   |   |     |   |       |             | | | |         |   | |           | |   |     | | |     |       |   |   |     | | | |   |         | | | |       |   | |     |   | | |   | |   |   | | | | 
 |   | |   |   |     |   |       |             | | | +---------|-----|-----------|-|---------|-|-|-----+       |   | +-|---------|-----|---------+ +-|-|-----------+ |     |   | | |   | |   |   | | | | 
 |   | |   |   |     |   |       |             | | |           |   | |           | |   |     | | |             |   | | |     | | | |   |             | |       |     |     |   | | |   | |   |   | | | | 
 |   +-|-----------------|-------|---------------------------------|-+           +-----|-----|-|-+             |   | | |     | | | |   |             | |       |     |     |   | | |   | |   |   | | | | 
 |     |   |   |     |   |       |             | | |           |   |               |   |     | |               |   | | |     | | | |   |             | |       |     |     |   | | |   | |   |   | | | | 
 |     |   |   |     |   |       |             | | |           |   +-------------------------------------------+   | +-|-------|---+   |             | |       |     |   +-|-----|-|---|-----|---+ | | | 
 |     |   |   |     |   |       |             | | |           |                   |   |     | |                   |   |     | | |     |             | |       |     |   | |   | | |   | |   |     | | | 
 +-----------------------|-------|-------------------------------------------------|---------|---+                 |   +-----|-+ |     |             | |       |     |   | +---|---|-----+   |     | | | 
       |   |   |     |   |       |             | | |           |                   |   |     | | |                 |         |   |     |             | |       |     |   |     | | |   |     |     | | | 
       |   |   |     |   |       |             | | |           |                   |   |     +-|-|-----------------|-------+ |   |     |             | +-------|---------------|-------------|-----|-|-+ 
       |   |   |     |   |       |             | | |           |                   |   |       | |                 |       | |   |     |             |         |     |   |     | | |   |     |     | |   
       +---+   |     |   |       +-------------|-|-|-----------------------------+ +---|-------|-------------------|---------|---------|-------------|-+       |     +---|-------+ |   |     |     | |   
               |     |   |                     | | |           |                 |     |       | |                 |       | |   |     |             | |       |         |     |   |   |     |     | |   
         +---------+ |   |                     | +-|-----------|-----------------------|-----------------------------------|-|---------|-+       +---|---------|---------|-----+   |   |     |     | |   
         |     |   | |   |                     |   |           |                 |     |       | |                 |       | |   |     | |       |   | |       |         |         |   |     |     | |   
         |   +-------+   |                     |   +-----------|---------------------------------|---------------------------|---|-----|-|-------------------------------|-------------|-----|-----|-+   
         |   | |   |     |                     |               |                 |     |       | |                 |       | |   |     | |       |   | |       |         |         |   |     |     |     
         +---+ |   |     |                     +---------------+                 +-----+       +-+         +-------+       | +---|-----|-|-------|-------------------------------------|-+   +-----+     
               |   |     |                                                                                 |               |     |     | |       |   | |       |         |         |   | |               
               |   |     |         +-----------------------------------------------------------------------+               +-----|-------|-----------|-|-------+         |         +-----+               
               |   |     |         |                                                                                             |     | |       |   | |                 |             |                 
   +-----------|---+     |         |                     +-----------------------------------------------------------------------|-------+       |   +---------------------------------|---------------+ 
   |           |         |         |                     |                                                                       |     |         |     |                 |             |               | 
   +---+ +-----+ +---------------------------------------|-----------------------------------------------------------------------|-----|-----------------------------------------------|---------------+ 
       | |       |       |         |                     |                                                                       |     |         |     |                 |             |                 
       | |       +-----------------|---------------------------------------------------------------------------------------------------+ +---------------------------------+           +---------------+ 
       | |               |         |                     |                                                                       |       |       |     |                 | |                           | 
       +-+               +---------+                     +-----------------------------------------------------------------------+       +-------+     +-----------------+ +---------------------------+ 
"""

enum Direction: String, CaseIterable {
    case up = "U", down = "D", left = "L", right = "R"
}

struct Point: Hashable {
    let x: Int
    let y: Int
    
    func distance( other: Point ) -> Int {
        return abs( x - other.x ) + abs( y - other.y )
    }
    
    static func +( left: Point, right: Point ) -> Point {
        return Point(x: left.x + right.x, y: left.y + right.y)
    }
    
    static func ==( left: Point, right: Point ) -> Bool {
        return left.x == right.x && left.y == right.y
    }
    
    func move( direction: Direction ) -> Point {
        switch direction {
        case .up:
            return self + Point(x: 0, y: -1)
        case .right:
            return self + Point(x: 1, y: 0)
        case .down:
            return self + Point(x: 0, y: 1)
        case .left:
            return self + Point(x: -1, y: 0)
        }
    }
}

class Network {
    let map: [[Character]]
    var direction = Direction.down
    var current = Point( x: 0, y: 0 )
    var path: [Character] = []
    var stepCount = 0

    init( input: String ) {
        map = input.split(separator: "\n").map { Array( $0 ) }

        for x in 0 ..< map[0].count {
            current = Point( x: x, y: 0 )
            if self[current] == "|" { break }
        }
    }
    
    subscript( point: Point ) -> Character {
        guard point.x >= 0 && point.y >= 0 else { return " " }
        guard point.y < map.count && point.x < map[point.y].count else { return " " }

        return map[point.y][point.x]
    }
    
    func traverse() -> String {
        while self[current] != " " {
            //print( current )
            nextMove()
            stepCount += 1
        }
        
        return String( path )
    }
    
    func nextMove() -> Void {
        if self[current] != " " {
            switch self[current] {
            case "|", "-", "+", " ":
                break
            default:
                path.append( self[current] )
            }

            let next = current.move( direction: direction )
            
            if self[next] != " " {
                current = next
            } else {
                switch direction {
                case .up, .down:
                    let right = current.move( direction: .right )
                    let left = current.move( direction: .left )
                    
                    if self[right] != " " {
                        current = right
                        direction = .right
                    } else if self[left] != " " {
                        current = left
                        direction = .left
                    } else {
                        current = next
                    }
                case .right, .left:
                    let up = current.move( direction: .up )
                    let down = current.move( direction: .down )
                    
                    if self[up] != " " {
                        current = up
                        direction = .up
                    } else if self[down] != " " {
                        current = down
                        direction = .down
                    } else {
                        current = next
                    }
                }
            }
        }
    }
}

let network = Network( input: input )

print( "Part1:", network.traverse() )
print( "Part2:", network.stepCount )
